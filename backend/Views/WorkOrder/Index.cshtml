@model List<backend.Models.WorkOrder>
@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager
@inject SignInManager<ApplicationUser> SignInManager

@{
    ViewData["Title"] = "Szerviztörténet";
    var currentUser = UserManager.GetUserAsync(User).Result;
    var userRoles = UserManager.GetRolesAsync(currentUser).Result;
    var isAdmin = userRoles.Contains("Admin");
    var isMechanic = userRoles.Contains("Mechanic");
    var isClient = userRoles.Contains("Client");
}

<h2>Munkálatok Áttekintése</h2>

<table class="table table-striped table-hover">
    <thead class="thead-dark">
        <tr>
            <th>Munkalap ID</th>
            <th>Időpont</th>
            <th>Létrehozva</th>
            <th>Státusz</th>
            <th>Gépjármű</th>
            @if (isAdmin)
            {
                <th>Ügyfél</th>
                <th>Szerelő</th>
            }
            <th>Megjegyzés</th>
            <th>Műveletek</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var workOrder in Model)
        {
            <tr>
                <td>@workOrder.WorkOrderId</td>
                <td>@workOrder.AppointmentTime.ToString("yyyy.MM.dd. HH:mm")</td>
                <td>@workOrder.CreatedAt.ToString("yyyy.MM.dd.")</td>
                <td>@(workOrder.IsActive == true ? "Aktív" : "Inaktív")</td>
                <td>
                    @if (workOrder.Car != null)
                    {
                        <span>@workOrder.Car.Manufacturer @workOrder.Car.Type (@workOrder.Car.LicencePlate)</span>
                    }
                </td>
                @if (isAdmin)
                {
                    <td>@(workOrder.Client?.UserName ?? "-")</td>
                    <td>@(workOrder.Mechanic?.UserName ?? "-")</td>
                }
                <td>@(string.IsNullOrEmpty(workOrder.Notes) ? "-" : workOrder.Notes)</td>
                <td>
                    <a href="@Url.Action("Details", "WorkOrder", new { id = workOrder.WorkOrderId })" class="btn btn-sm btn-info">Részletek</a>
                    @if (isAdmin || isMechanic)
                    {
                        <a href="@Url.Action("Edit", "WorkOrder", new { id = workOrder.WorkOrderId })" class="btn btn-sm btn-warning">Szerkesztés</a>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>
